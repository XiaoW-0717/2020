# 定位表相关功能

[TOC]

## 1、前端

- DrillLocationData.vue

  ```
  
  ```

  

## 2、后端

### 2.1 models.py

```python
# 设置数据库
connect(alias='drill_system', db='钻孔数据管理子系统',
        host='192.168.55.110', port=20000)
connect(alias='rs_system', db='遥感数据管理子系统', host='192.168.55.110', port=20000)
connect(alias='geo_example', db='geo_example',
        host='192.168.55.110', port=20000)


class DrillLocation(Document):
    '''钻孔定位表'''
    zk_name = StringField(required=True)
    coordinate_E = FloatField(required=True)
    coordinate_N = FloatField(required=True)
    coordinate_R = FloatField(required=True)
    max_depth = FloatField(required=True)
    track_type = StringField(required=True)
    location = PointField()
    # zk_num = StringField(required=True, max_length=200)
    # coordinate_E = FloatField(required=True, max_length=50)
    # coordinate_N = FloatField(required=True, max_length=50)
    # coordinate_R = FloatField(required=True, max_length=50)
    # coordniate = ListField()
    meta = {'db_alias': 'drill_system',
            'indexes': [[("location.coordinates", "2dsphere"), ("datetime", 1)]]}

```



### 2.2 serializers.py

```python
from rest_framework_mongoengine.serializers import DocumentSerializer
class DrillLocationSerializer(DocumentSerializer):
    '''钻孔数据管理子系统定位表数据'''
    class Meta:
        model = DrillLocation
        fields = "__all__"
```



### 2.3views.py

```python
class ShowDrillLocationView(APIView):
    def get(self, request, *args, **kwargs):
        """
        docstring
        """
        with switch_collection(DrillLocation, '定位表') as DrillLocationTest:
            try:
                drill_location = DrillLocationTest.objects.all().order_by('_id')  # 一定要排序
                page = MyPagination()
                # 实例化查询，获取分页的数据
                page_chapter = page.paginate_queryset(
                    queryset=drill_location, request=request, view=self)
                # print(page_chapter)
                # 序列化及结果返回，将分页后返回的数据, 进行序列化
                ser = DrillLocationSerializer(
                    instance=page_chapter, many=True)
                # print(ser)
                data = {'list': ser.data}
            except Exception as exc:
                response = self.handle_exception(exc)
                # print('报错走这里')
                return response
                # return HttpResponse("出错了")
            return page.get_paginated_response(data)
```



### 2.4urls.py

```python
  path('showdrilllocation/', ShowDrillLocationView.as_view(),
         name="showdrilllocation"),  # 钻孔定位表数据展示
```



补充：定位表需要与钻孔信息联系，查看柱状图，所以使用钻孔号查询（特定区域一般钻孔号单一）