# 地震数据解析页面

[TOC]

##  前言 

- 将`SEGY`数据写入服务器，进行今解析

- `SeismicAnalysi.vue`
- `SeismicFileRead`





## 1. 后端

### 1.1 服务器文件表格展示

- 将服务器中文件返回前端表格展示

- `views.py`

  ```python
  # 地震数据解析，获取文件
  @require_http_methods(['GET'])
  def SeismicFileRead(request):
  
      # base_dir = 'c:/'
      base_dir = "././pic/"
      list = os.listdir(base_dir)
  
      filelist = []
      for i in range(0, len(list)):
          path = os.path.join(base_dir, list[i])
          if os.path.isfile(path):
              filelist.append(list[i])
      list_db = []
      content = {}
      for i in range(0, len(filelist)):
          path = os.path.join(base_dir, filelist[i])
          if os.path.isdir(path):
              continue
          # 获取文件的修改时间
          timestamp = os.path.getmtime(path)
          # print(timestamp)
          # 获取文件的修改时间
          # ts1 = os.stat(path).st_mtime
          # print(ts1)
          # 获取文件的大小,结果保留两位小数，单位为MB
          filesize = os.path.getsize(path)
          fsize = filesize/float(1024*1024)
          size = round(fsize, 2)
          filesize = str(size) + 'MB'
          # print(size)
  
          date = datetime.datetime.fromtimestamp(timestamp)
          upload_time = date.strftime('%Y-%m-%d %H:%M:%S')
          # upload_time = date.strftime('%Y-%m-%d')
          # print(list[i], ' 最近修改时间是: ', date.strftime('%Y-%m-%d %H:%M:%S'))
  
          fileinfo = {
              'filename': list[i],
              'filesize': filesize,
              'upload_time': upload_time,
          }
          # print(type(fileinfo))
          # json_str = str(fileinfo)
          # print(type(json_str))
          list_db.append(fileinfo)
          content = json.dumps(list_db)    #这个地方要用字符串传到前端去
      print(content)
      print(type(content))
      return HttpResponse(content, "application/json")
  ```

  

### 1.2 服务器文件删除

- `views.py`

  ```python
  # 地震数据解析，删除服务器文件
  @require_http_methods(['POST'])
  def SeismicAnalysisDelete(request):
      # filename1 = request.POST
      # print(filename1)
      filename = request.POST.get('filename')
      print(filename)
      content = "..\mongeostore_env\pic\\" + filename
      os.remove(content)
      return HttpResponse('success')
  ```

  

### 1.3 解析数据

- `views.py`

  ```python
  # 地震数据解析，获取服务器文件
  @require_http_methods(['GET'])
  def SeismicFileRead(request):
  
      # base_dir = 'c:/'
      base_dir = "././pic/"
      list = os.listdir(base_dir)
  
      filelist = []
      for i in range(0, len(list)):
          path = os.path.join(base_dir, list[i])
          if os.path.isfile(path):
              filelist.append(list[i])
      list_db = []
      content = {}
      for i in range(0, len(filelist)):
          path = os.path.join(base_dir, filelist[i])
          if os.path.isdir(path):
              continue
          # 获取文件的修改时间
          timestamp = os.path.getmtime(path)
          # print(timestamp)
          # 获取文件的修改时间
          # ts1 = os.stat(path).st_mtime
          # print(ts1)
          # 获取文件的大小,结果保留两位小数，单位为MB
          filesize = os.path.getsize(path)
          fsize = filesize/float(1024*1024)
          size = round(fsize, 2)
          filesize = str(size) + 'MB'
          # print(size)
  
          date = datetime.datetime.fromtimestamp(timestamp)
          upload_time = date.strftime('%Y-%m-%d %H:%M:%S')
          # upload_time = date.strftime('%Y-%m-%d')
          # print(list[i], ' 最近修改时间是: ', date.strftime('%Y-%m-%d %H:%M:%S'))
  
          fileinfo = {
              'filename': list[i],
              'filesize': filesize,
              'upload_time': upload_time,
          }
          # print(type(fileinfo))
          # json_str = str(fileinfo)
          # print(type(json_str))
          list_db.append(fileinfo)
          content = json.dumps(list_db)  # 这个地方要用字符串传到前端去
      # print(content)
      # print(type(content))
      return HttpResponse(content, "application/json")
  
  
  # 地震数据解析，获取服务器文件
  @require_http_methods(['GET'])
  def SeismicHeaderQuery(request):
      print(request.GET)
      filename = request.GET.get('filename')
      filequery = request.GET.get('queryparams')
      # print(filename)
      content = "..\mongeostore_env\pic\\" + filename
  
      try:
          with segyio.open(content, mode="r", strict=False, ignore_geometry=False, endian='big') as f:
              if filequery == 'header':
                  datatest = f.header[0]
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              elif filequery == 'Bin':
                  datatest = f.bin
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              elif filequery == 'track':
                  datatest = f.text
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              elif filequery == 'traces':
                  datatest = f.trace
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              elif filequery == 'trace1':
                  datatest = f.trace[0]  # 拿到segy中数据
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              elif filequery == 'trace_1':
                  datatest = f.trace[-1]
  
                  # print(str(datatest))
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
              else:
                  datatest = f.trace[int(filequery)]
                  # print(filequery)
                  # print(type(filequery))
                  # print(datatest)
                  queryinfo = str(datatest)
                  return HttpResponse(queryinfo)
      except:
          print('解析错误')
          return HttpResponse('err')
  ```



### 1.4 上传数据

- `views.py`

  ```python
  # 地震数据解析，本地文件上传服务器
  class SeismicAnalysisUpload(APIView):
      def get(self, request, *args, **kwargs):
          """
          docstring
          """
          # print("走的是GET方法")
          response = {}
          response['code'] = 200
          # response["Access-Control-Allow-Methods"] = "POST"
          return HttpResponse(json.dumps(response), content_type="application/json")
  
      def post(self, request):
          File = request.FILES.get("file", None)
          # filename = request.POST.get('filename')
          # 保存到本地
          if not os.path.exists('pic/'):
              os.mkdir('pic/')
          with open("./pic/%s" % File.name, 'wb+') as f:
              for chunk in File.chunks():
                  f.write(chunk)
              f.close()
          return HttpResponse('success')
  ```

  

### 1.5 云端数据

- `views.py`

  ```
  
  ```

  - [进度条](https://blog.csdn.net/WDCCSDN/article/details/89395287)
  - [Django进度条](https://blog.csdn.net/chaoren499/article/details/97135142)



## 2. 前端

- `SeismicAnalysi.vue`

  ```
  
  ```

  

- `UploadFile.vue`

  ```
  
  ```

  